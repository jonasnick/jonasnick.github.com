
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Evaluating Satoshi's Clustering Heuristic - nickler's</title>
  <meta name="author" content="Jonas Nick">

  
  <meta name="description" content="In a previous post I showed that once an attacker captures a Bloom filter of a BitcoinJ powered wallet from the P2P network
he can find out all &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jonasnick.github.io/blog/2015/03/27/evaluating-satoshis-clustering-heuristic/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>

  <link href="/atom.xml" rel="alternate" title="nickler's" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">-->
<!--<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">-->
<!--<link href="https://fonts.googleapis.com/css?family=Arvo" rel="stylesheet" type="text/css">-->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<style type="text/css">

/**
 * HTML5 âœ° Boilerplate
 *
 * style.css contains a reset, font normalization and some base styles.
 *
 * Credit is left where credit is due.
 * Much inspiration was taken from these projects:
 * - yui.yahooapis.com/2.8.1/build/base/base.css
 * - camendesign.com/design/
 * - praegnanz.de/weblog/htmlcssjs-kickstart
 */


/**
 * html5doctor.com Reset Stylesheet (Eric Meyer's Reset Reloaded + HTML5 baseline)
 * v1.6.1 2010-09-17 | Authors: Eric Meyer & Richard Clark
 * html5doctor.com/html-5-reset-stylesheet/
 */

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: 0;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;}

h1.ipynb h2.ipynb h3.ipynb h4.ipynb h5.ipynb h6.ipynb {
h1.ipynb h2.ipynb ... {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}

/*html, body,*/ div, span, object, iframe,
/*h1, h2, h3, h4, h5, h6,*/ p, blockquote, pre,
abbr, address, cite, code, del, dfn, em, img, ins, kbd, q, samp,
small, strong, sub, sup, var, b, i, dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, figcaption, figure,
footer, header, hgroup, menu, nav, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}

sup { vertical-align: super; }
sub { vertical-align: sub; }

article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
  display: block;
}

blockquote, q { quotes: none; }

blockquote:before, blockquote:after,
q:before, q:after { content: ""; content: none; }

ins { background-color: #ff9; color: #000; text-decoration: none; }

mark { background-color: #ff9; color: #000; font-style: italic; font-weight: bold; }

del { text-decoration: line-through; }

abbr[title], dfn[title] { border-bottom: 1px dotted; cursor: help; }

table { border-collapse: collapse; border-spacing: 0; }

hr { display: block; height: 1px; border: 0; border-top: 1px solid #ccc; margin: 1em 0; padding: 0; }

input, select { vertical-align: middle; }


/**
 * Font normalization inspired by YUI Library's fonts.css: developer.yahoo.com/yui/
 */

div.ipynb { font:13px/1.231 sans-serif; *font-size:small; } /* Hack retained to preserve specificity */
select, input, textarea, button { font:99% sans-serif; }

/* Normalize monospace sizing:
   en.wikipedia.org/wiki/MediaWiki_talk:Common.css/Archive_11#Teletype_style_fix_for_Chrome */
pre, code, kbd, samp { font-family: monospace, sans-serif; }

em,i { font-style: italic; }
b,strong { font-weight: bold; }

</style>
<style type="text/css">

/* Flexible box model classes */
/* Taken from Alex Russell http://infrequently.org/2009/08/css-3-progress/ */
 
.hbox {
	display: -webkit-box;
	-webkit-box-orient: horizontal;
	-webkit-box-align: stretch;
 
	display: -moz-box;
	-moz-box-orient: horizontal;
	-moz-box-align: stretch;
 
	display: box;
	box-orient: horizontal;
	box-align: stretch;
}
 
.hbox > * {
	-webkit-box-flex: 0;
	-moz-box-flex: 0;
	box-flex: 0;
}
 
.vbox {
	display: -webkit-box;
	-webkit-box-orient: vertical;
	-webkit-box-align: stretch;
 
	display: -moz-box;
	-moz-box-orient: vertical;
	-moz-box-align: stretch;
 
	display: box;
	box-orient: vertical;
	box-align: stretch;
}
 
.vbox > * {
	-webkit-box-flex: 0;
	-moz-box-flex: 0;
	box-flex: 0;
}
  
.reverse {
	-webkit-box-direction: reverse;
	-moz-box-direction: reverse;
	box-direction: reverse;
}
 
.box-flex0 {
	-webkit-box-flex: 0;
	-moz-box-flex: 0;
	box-flex: 0;
}
 
.box-flex1, .box-flex {
	-webkit-box-flex: 1;
	-moz-box-flex: 1;
	box-flex: 1;
}
 
.box-flex2 {
	-webkit-box-flex: 2;
	-moz-box-flex: 2;
	box-flex: 2;
}
 
.box-group1 {
	-webkit-box-flex-group: 1;
	-moz-box-flex-group: 1;
	box-flex-group: 1;
}
 
.box-group2 {
	-webkit-box-flex-group: 2;
	-moz-box-flex-group: 2;
	box-flex-group: 2;
}
 
.start {
	-webkit-box-pack: start;
	-moz-box-pack: start;
	box-pack: start;
}
 
.end {
	-webkit-box-pack: end;
	-moz-box-pack: end;
	box-pack: end;
}
 
.center {
	-webkit-box-pack: center;
	-moz-box-pack: center;
	box-pack: center;
}

</style>
<style type="text/css">
/**
 * Primary styles
 *
 * Author: IPython Development Team
 */


div.ipynb {
    overflow: hidden;
}

blockquote {
    border-left: 4px solid #DDD;
    padding: 0 15px;
    color: #777;
}

span#save_widget {
    padding: 5px;
    margin: 0px 0px 0px 300px;
    display:inline-block;
}

span#notebook_name {
    height: 1em;
    line-height: 1em;
    padding: 3px;
    border: none;
    font-size: 146.5%;
}


.ui-menubar-item .ui-button .ui-button-text {
    padding: 0.4em 1.0em;
    font-size: 100%;
}

.ui-menu {
  -moz-box-shadow:    0px 6px 10px -1px #adadad;
  -webkit-box-shadow: 0px 6px 10px -1px #adadad;
  box-shadow:         0px 6px 10px -1px #adadad;
}

.ui-menu .ui-menu-item a {
    border: 1px solid transparent;
    padding: 2px 1.6em;
}

.ui-menu .ui-menu-item a.ui-state-focus {
    margin: 0;
}

.ui-menu hr {
    margin: 0.3em 0;
}

#menubar_container {
    position: relative;
}

#notification_area {
    position: absolute;
    right: 0px;
    top: 0px;
    height: 25px;
    padding: 3px 0px;
    padding-right: 3px;
    z-index: 10;
}

.notification_widget{
    float : right;
    right: 0px;
    top: 1px;
    height: 25px;
    padding: 3px 6px;
    z-index: 10;
}

.toolbar {
    padding: 3px 15px;
}

#maintoolbar > select, #maintoolbar label {
    font-size: 85%;
    margin-left:0.3em;
    margin-right:0.3em;

}


div#main_app {
    width: 100%;
    position: relative;
}

span#quick_help_area {
    position: static;
    padding: 5px 0px;
    margin: 0px 0px 0px 0px;
}

.help_string {
    float: right;
    width: 170px;
    padding: 0px 5px;
    text-align: left;
    font-size: 85%;
}

.help_string_label {
    float: right;
    font-size: 85%;
}

div#notebook_panel {
    margin: 0px 0px 0px 0px;
    padding: 0px;
}

div#notebook {
    overflow-y: scroll;
    overflow-x: auto;
    width: 100%;
    /* This spaces the cell away from the edge of the notebook area */
    padding: 5px 5px 15px 5px;
    margin: 0px;
    background-color: white;
}

div#pager_splitter {
    height: 8px;
}

#pager_container {
    position : relative;
}

div#pager {
    padding: 15px;
    overflow: auto;
    display: none;
}

div.ui-widget-content {
    border: 1px solid #aaa;
    outline: none;
}

.cell {
    border: 1px solid transparent;
}

div.cell {
    width: 100%;
    padding: 5px 5px 5px 0px;
    /* This acts as a spacer between cells, that is outside the border */
    margin: 2px 0px 2px 0px;
    outline: none;
}

div.code_cell {
    background-color: #6bg094;
}

/* any special styling for code cells that are currently running goes here */
div.code_cell.running {
}

div.prompt {
    /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
    width: 11ex;
    /* This 0.4em is tuned to match the padding on the CodeMirror editor. */
    padding: 0.4em;
    margin: 0px;
    font-family: monospace;
    text-align: right;
    /* This has to match that of the the CodeMirror class line-height below */	
    line-height: 1.231;
}

div.input {
    page-break-inside: avoid;
}

/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
    color: black;
    border: 1px solid #ddd;
    border-radius: 3px;
    background: #f7f7f7;
}

div.input_prompt {
    color: navy;
    border-top: 1px solid transparent;
}

div.output_wrapper {
    /* This is a spacer between the input and output of each cell */
    margin-top: 5px;
    margin-left: 5px;
    /* FF needs explicit width to stretch */
    width: 100%;
    /* this position must be relative to enable descendents to be absolute within it */
    position: relative;
}

/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  
  overflow: auto;
  border-radius: 3px;
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, .8);
}

/* output div while it is collapsed */
div.output_collapsed {
  margin-right: 5px;
}

div.out_prompt_overlay {
  height: 100%;
  padding: 0px;
  position: absolute;
  border-radius: 3px;
}

div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}

div.output_prompt {
    color: darkred;
    /* 5px right shift to account for margin in parent container */
    margin: 0 5px 0 -5px;
}

/* This class is the outer container of all output sections. */
div.output_area {
    padding: 0px;
    page-break-inside: avoid;
}

	
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
div.output_area pre {	
    font-family: monospace;	
    margin: 0;
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
    color: black;
    background-color: white;
}

/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
    padding: 0.44em 0.4em 0.4em 1px;
}

/* The rest of the output_* classes are for special styling of the different
   output types */

/* all text output has this class: */
div.output_text {
    text-align: left;
    color: black;
    font-family: monospace;
    /* This has to match that of the the CodeMirror class line-height below */	
    line-height: 1.231;
}

/* stdout/stderr are 'text' as well as 'stream', but pyout/pyerr are *not* streams */
div.output_stream {
    padding-top: 0.0em;
    padding-bottom: 0.0em;
}
div.output_stdout {
}
div.output_stderr {
    background: #fdd; /* very light red background for stderr */
}

div.output_latex {
    text-align: left;
    color: black;
}

div.output_html {
}

div.output_png {
}

div.output_jpeg {
}

div.text_cell {
    background-color: white;
    padding: 5px 5px 5px 5px;
}

div.text_cell_input {
    color: black;
    border: 1px solid #ddd;
    border-radius: 3px;
    background: #f7f7f7;
}

div.text_cell_render {
    font-family: "PT Sans", sans-serif;
    outline: none;
    resize: none;
    width:  inherit;
    border-style: none;
    padding: 5px;
    color: #222222;
}

/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font. 
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */

.CodeMirror {
    line-height: 1.231;  /* Changed from 1em to our global default */
}

.CodeMirror-scroll {
    height: auto;     /* Changed to auto to autogrow */
    /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
    /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
    overflow-y: hidden;
    overflow-x: auto; /* Changed from auto to remove scrollbar */
}

/* CSS font colors for translated ANSI colors. */


.ansiblack {color: black;}
.ansired {color: darkred;}
.ansigreen {color: darkgreen;}
.ansiyellow {color: brown;}
.ansiblue {color: darkblue;}
.ansipurple {color: darkviolet;}
.ansicyan {color: steelblue;}
.ansigrey {color: grey;}
.ansibold {font-weight: bold;}

.completions {
    position: absolute;
    z-index: 10;
    overflow: hidden;
    border: 1px solid grey;
}

.completions select {
    background: white;
    outline: none;
    border: none;
    padding: 0px;
    margin: 0px;
    overflow: auto;
    font-family: monospace;
}

option.context {
  background-color: #DEF7FF;
}
option.introspection {
  background-color: #EBF4EB;
}

/*fixed part of the completion*/
.completions p b {
    font-weight:bold;
}

.completions p {
    background: #DDF;
    /*outline: none;
    padding: 0px;*/
    border-bottom: black solid 1px;
    padding: 1px;
    font-family: monospace;
}

pre.dialog {
    background-color: #f7f7f7;
    border: 1px solid #ddd;
    border-radius: 3px;
    padding: 0.4em;
    padding-left: 2em;
}

p.dialog {
    padding : 0.2em;
}

.shortcut_key {
    display: inline-block;
    width: 15ex;
    text-align: right;
    font-family: monospace;
}

.shortcut_descr {
}

/* Word-wrap output correctly.  This is the CSS3 spelling, though Firefox seems
   to not honor it correctly.  Webkit browsers (Chrome, rekonq, Safari) do.
 */
pre, code, kbd, samp { white-space: pre-wrap; }

#fonttest {
    font-family: monospace;
}

.js-error {
    color: darkred;
}

</style>
<style type="text/css">
.rendered_html {color: black;}
.rendered_html em {font-style: italic;}
.rendered_html strong {font-weight: bold;}
.rendered_html u {text-decoration: underline;}
.rendered_html :link { text-decoration: underline }
.rendered_html :visited { text-decoration: underline }
.rendered_html h1 {font-size: 197%; margin: .65em 0; font-weight: bold;}
.rendered_html h2 {font-size: 153.9%; margin: .75em 0; font-weight: bold;}
.rendered_html h3 {font-size: 123.1%; margin: .85em 0; font-weight: bold;}
.rendered_html h4 {font-size: 100% margin: 0.95em 0; font-weight: bold;}
.rendered_html h5 {font-size: 85%; margin: 1.5em 0; font-weight: bold;}
.rendered_html h6 {font-size: 77%; margin: 1.65em 0; font-weight: bold;}
.rendered_html ul {list-style:disc; margin: 1em 2em;}
.rendered_html ul ul {list-style:square; margin: 0em 2em;}
.rendered_html ul ul ul {list-style:circle; margin-left: 0em 2em;}
.rendered_html ol {list-style:decimal; margin: 1em 2em;}
.rendered_html ol ol {list-style:upper-alpha; margin: 0em 2em;}
.rendered_html ol ol ol {list-style:lower-alpha; margin: 0em 2em;}
.rendered_html ol ol ol ol {list-style:lower-roman; margin: 0em 2em;}
/* any extras will just be numbers: */
.rendered_html ol ol ol ol ol {list-style:decimal; margin: 0em 2em;}

.rendered_html hr {
    color: black;
    background-color: black;
}

.rendered_html pre {
    margin: 1em 2em;
}

.rendered_html blockquote {
    margin: 1em 2em;
}

.rendered_html table {
    border: 1px solid black;
    border-collapse: collapse;
    margin: 1em 2em;
}

.rendered_html td {
    border: 1px solid black;
    text-align: left;
    vertical-align: middle;
    padding: 4px;
}

.rendered_html th {
    border: 1px solid black;
    text-align: left;
    vertical-align: middle;
    padding: 4px;
    font-weight: bold;
}

.rendered_html tr {
    border: 1px solid black;
}    

.rendered_html p + p {
    margin-top: 1em;
}


</style>
<style type="text/css">
/* Overrides of notebook CSS for static HTML export

*/
div.ipynb {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.4em;
}

</style>
<meta charset="UTF-8">
<style type="text/css">
.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #808080 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0040D0 } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>

  

</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
    <li><a href="https://twitter.com/n1ckler" title="follow on twitter"><img src="/images/bird.png" height="32"/></a></li>
    <li><a href="https://github.com/jonasnick" title="github repo"><img src="/images/GitHub-Mark-64px.png" height="32"/></a></li>
    <li><a href="/atom.xml" title="subscribe via RSS"><img src="/images/rss.png" height="32"/></a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jonasnick.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="https://github.com/jonasnick">Code</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Evaluating Satoshi's Clustering Heuristic</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-27T12:47:00+01:00" pubdate data-updated="true">Mar 27<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In a <a href="/blog/2015/02/12/privacy-in-bitcoinj/">previous post</a> I showed that once an attacker captures a Bloom filter of a BitcoinJ powered wallet from the P2P network
he can find out all public keys this wallet contains with very high probability.
<a href="http://www.disco.ethz.ch/members/cdecker.html">Christian Decker</a> and I have collected the pubkeys contained in more than 70,000 Bloom filters.
We are very interested in privacy aspects of bitcoin, so we see this as a unique opportunity to evaluate Satoshi&rsquo;s classic clustering heuristic: all inputs of a transaction belong to the same owner.</p>

<blockquote><p>Some linking is still unavoidable with multi-input transactions, which necessarily reveal that their inputs were owned by the same owner. <br/>The risk is that if the owner of a key is revealed, linking could reveal other transactions that belonged to the same owner.</p><footer><strong>Satoshi Nakamoto</strong> <cite>Bitcoin: A Peer-to-Peer Electronic Cash System</cite></footer></blockquote>


<p>So for each wallet and for each contained pubkey we recursively apply the heuristic to all transactions the pubkey occurs in.
There have been a few academic publications on this matter such as <a href="http://eprint.iacr.org/2012/596.pdf">Androulaki et al. 2013</a> and <a href="http://cseweb.ucsd.edu/~savage/papers/IMC13.pdf">Meiklejohn et al. 2013</a>.
Also, there are some online tools and companies that allow exploiting this property of bitcoin: <a href="https://bitiodine.net/">bitiodine</a>, <a href="http://coinalytics.co/">coinalytics</a> and <a href="http://www.walletexplorer.com/">walletexplorer</a>.</p>

<p>But so far nobody had access to a collection of actual wallets in order to evaluate the performance of the heuristic.
Thus, previous statements and conclusions were either based on simulations (Androulaki et al.) or relied on intuitions.</p>

<p>We expect that the probability that a pubkey that was found with the heuristic really belongs to the wallet (<strong>precision</strong>) is close to 1 because this is how all standard wallets create transactions.
Countermeasures against this are <a href="https://bitcointalk.org/index.php?topic=139581.0">coinjoin transactions</a> which certainly do not require that &ldquo;entities would need to reveal their private keys to each other&rdquo; (Meiklejohn et al. 2013).
However, what we are really interested in is the <strong>recall</strong> &ndash; the percentage of the wallet&rsquo;s pubkeys an attacker learns given he knows one pubkey &ndash; and how we can improve it.</p>

<p><strong>tl;dr:</strong> As expected, the probability that a pubkey really belongs to the same entity (precision) is very high &hellip; whereas the amount of pubkeys that we can find (recall) is surprisingly small. We show a simply tweak that can improve the recall significantly.</p>

<!-- more -->


<h2>Data</h2>

<p>Computing a wallet&rsquo;s pubkeys given the captured bloom filter takes about 1 hour.
But thanks to ETH Zurich&rsquo;s computing clusters and Christian Decker&rsquo;s blockchain analysis infrastructure we could compute the collection of 70,078 wallets in a few weeks.</p>

<p><strong>WRITE NUMBER OF CLUSTERS before and after removal</strong></p>

<p>In order to remove duplicates, we grouped wallets which have a pubkey in common such that only the one with the most pubkeys remains.
The set of the wallet&rsquo;s useragents is quite diverse</p>

<p><strong>WRONG because this is before duplicate removal</strong></p>

<table>
<thead>
<tr>
<th></th>
<th> Useragent         </th>
<th> Count      </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> Bitcoin Wallet    </td>
<td> 48313 </td>
</tr>
<tr>
<td></td>
<td> Multibit          </td>
<td> 15125</td>
</tr>
<tr>
<td></td>
<td> KnC               </td>
<td> 659</td>
</tr>
<tr>
<td></td>
<td> Hive              </td>
<td> 518</td>
</tr>
<tr>
<td></td>
<td> Green Wallet      </td>
<td> 127</td>
</tr>
<tr>
<td></td>
<td> breadwallet       </td>
<td> 84</td>
</tr>
<tr>
<td></td>
<td> others            </td>
<td> 5252</td>
</tr>
</tbody>
</table>


<p>For our analysis we choose to select only Bitcoin Wallet, Multibit (non-HD), KnC and Hive and omit the more obscure wallets.
Everybody who has worked with the blockchain knows that it is a strange place where all sorts of things can happen. Only a single pubkey erroneously included in the cluster can lead to giant superclusters.</p>

<p>We have learned from the previous post that there is still a chance (false positive rate) that we wrongly associate a pubkey with a wallet.
A wallet using BitcoinJ version newer than 0.12 (which introduced hierarchical deterministic wallets) typically has a false positive rate around 0.000146, which would result in around 1.3 expected false positive pubkeys per wallet.
Unfortunately, a single false positive per wallet can already vastly destroy the accuracy of our analysis, so we have to select wallets with a much lower false positive rate.
We decide to require a false positive rate smaller than 0.00001, which leads to an expected total number of false positives in <em>all</em> wallets of <em>0.31</em>.
This is because BitcoinJ wallets older than 0.12 mostly have extremely small false positive rates and surprisingly BitcoinJ &lt; 0.12 is still widely deployed.
We end up with 20,765 wallets.
<strong>WRONG because we have to select the ones that also remain after duplicate removal!</strong>
One should note that most android bitcoin wallets have only a single pubkey because before HD wallets it was a pain to create a new pubkey.</p>

<p>//
// is there a correlation between wallet size and fp rate: yes! and it&rsquo;s significant, but in the graph we can&rsquo;t see anything
// we only have a small amount of clusters yet
// show histogram for all cluster sizes for user agents!
// show histogram for clusters sizes for fp rate filtered
// with limited data there is a huge difference
// show plot fp_rate vs. num pubkeys
We do have to carefully investigate that a selection does not introduce a strong bias in the wallets.</p>

<p>Regarding the data we have to state some facts very clearly.
We assume that the fraction of filters that include public keys that are not in the wallet is negligible.
&lsquo;Poisened&rsquo; filters could be deliberately broadcasted by some nodes to thwart analyses like ours.
Similarly, watch-only addresses also entail inclusion into the filter even though the private key is not owned by the wallet.
However, none of the selected useragents implements a watch-only feature and a small fraction of poisened filters does not influence
the analysis very much since each wallet has the same influence on the performance metric.</p>

<p>Also, our data comprises <em>only</em> BitcoinJ wallets, which might have a different coin selection policy than other wallet software.
When composing transactions BitcoinJ minimizes fees whereas for example Bitcoin Core minimizes change.
More specifically, because we selected the aforementioned useragents we can only account for the particular spending habits of people using
these wallet softwares.
* HD wallets have better privacy</p>

<h2>Evaluation</h2>

<p>In order to evaluate the performance of the heuristic we use standard performance metrics for binary classification: precision and recall.
Precision can be understand as the probability that a pubkey $p&#8217;$ is owned by a wallet given that it was found by applying heuristic $H$ to some other pubkey $p$ of the wallet.
of the user $\text{prec(p)} = P(O(p&#8217;) | p&#8217; \in H(p))$. Similarly, recall can be seen as the probability that a pubkey $p&#8217;$ will be found by the heuristic given that it belongs to the the wallet $\text{rec(p)} = P(p&#8217; \in H(p) | O(p&#8217;))$. In order to obtain final metrics we average over all pubkeys of a wallet and all wallets.</p>

<p>In detail, let $W$ be our collection of $n$ wallets where each $w_i \in W$ is a set of pubkeys, then we have</p>

<p>$\text{prec(W)} = \frac{1}{n} \sum_i \frac{1}{|w_i|} \sum_{p\in w_i} \frac{w_i \cap H(p)}{|H(p)|}$ and</p>

<p>$\text{rec(W)} = \frac{1}{n} \sum_i \frac{1}{|w_i|} \sum_{p\in w_i} \frac{w_i \cap H(p)}{|w_i|}$.</p>

<ul>
<li>table read db and average, confidence interval, standard deviation per wallet</li>
<li>make graph for size of wallet</li>
</ul>


<h2>Tweaking</h2>

<p>Christian Decker came up with a heuristic we have not seen mentioned anywhere before:
If there is a unique output with a smaller value than any of the inputs then this has to be the change address.
Combined with Satoshi&rsquo;s heuristic we get&hellip;
* decker&rsquo;s heuristic</p>

<h2>Conclusion</h2>

<p>If you have ideas for additional tweaks you want to see evaluated feel free to contact me.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jonas Nick</span></span>

      








  


<time datetime="2015-03-27T12:47:00+01:00" pubdate data-updated="true">Mar 27<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bitcoin/'>bitcoin</a>, <a class='category' href='/blog/categories/golang/'>golang</a>, <a class='category' href='/blog/categories/privacy/'>privacy</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <div class="padding">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="n1ckler">Tweet</a>
    </div>
  
  
  

</div>


    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/17/ethereum-bug-bounty-submissions/" title="Previous Post: Ethereum Bug Bounty Submissions">&laquo; Ethereum Bug Bounty Submissions</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/27/evaluating-satoshis-clustering-heuristic/">Evaluating Satoshi's Clustering Heuristic</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/17/ethereum-bug-bounty-submissions/">Ethereum Bug Bounty Submissions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/17/bitcoin-seeder-dos-vulnerability/">Bitcoin Seeder DoS vulnerability</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/06/guessing-bitcoins-p2p-connections/">Guessing bitcoin's P2P connections</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/12/privacy-in-bitcoinj/">Privacy in BitcoinJ</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <span style="font-size : 11px" id="tag-cloud"><a href='/blog/categories/algo-trading' style='font-size: 112.0%'>algo trading</a> <a href='/blog/categories/astar' style='font-size: 112.0%'>Astar</a> <a href='/blog/categories/bitcoin' style='font-size: 160.0%'>bitcoin</a> <a href='/blog/categories/blender' style='font-size: 112.0%'>blender</a> <a href='/blog/categories/c-' style='font-size: 112.0%'>c++</a> <a href='/blog/categories/cryptocurrencies' style='font-size: 112.0%'>cryptocurrencies</a> <a href='/blog/categories/evolution' style='font-size: 112.0%'>evolution</a> <a href='/blog/categories/genetic-algorithms' style='font-size: 112.0%'>genetic algorithms</a> <a href='/blog/categories/golang' style='font-size: 136.0%'>golang</a> <a href='/blog/categories/java' style='font-size: 124.0%'>java</a> <a href='/blog/categories/kinect' style='font-size: 112.0%'>kinect</a> <a href='/blog/categories/latex' style='font-size: 112.0%'>LaTeX</a> <a href='/blog/categories/machine-learning' style='font-size: 124.0%'>machine learning</a> <a href='/blog/categories/marioai' style='font-size: 112.0%'>MarioAI</a> <a href='/blog/categories/neuro' style='font-size: 112.0%'>neuro</a> <a href='/blog/categories/pragmatics' style='font-size: 124.0%'>pragmatics</a> <a href='/blog/categories/privacy' style='font-size: 136.0%'>privacy</a> <a href='/blog/categories/psycholinguistics' style='font-size: 112.0%'>Psycholinguistics</a> <a href='/blog/categories/python' style='font-size: 148.0%'>python</a> <a href='/blog/categories/r' style='font-size: 136.0%'>R</a> <a href='/blog/categories/racket' style='font-size: 112.0%'>racket</a> <a href='/blog/categories/regression' style='font-size: 112.0%'>regression</a> <a href='/blog/categories/signaling-games' style='font-size: 112.0%'>signaling games</a> <a href='/blog/categories/snake' style='font-size: 112.0%'>snake</a> <a href='/blog/categories/source-engine' style='font-size: 112.0%'>source engine</a> <a href='/blog/categories/sweave' style='font-size: 112.0%'>Sweave</a> </span>
</section>

<section>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>. 2015 - Jonas Nick -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nicklers';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jonasnick.github.io/blog/2015/03/27/evaluating-satoshis-clustering-heuristic/';
        var disqus_url = 'http://jonasnick.github.io/blog/2015/03/27/evaluating-satoshis-clustering-heuristic/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>












</body>
</html>
